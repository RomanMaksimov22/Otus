root@WS-Ubuntu:/otus/vagrant_selinux# vagrant ssh
[vagrant@selinux ~]$ 
[root@selinux ~]# systemctl status nginx
× nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; preset: disabled)
     Active: failed (Result: exit-code) since Fri 2025-09-19 16:28:20 UTC; 13min ago
    Process: 7339 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 7352 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=1/FAILURE)
        CPU: 11ms

Sep 19 16:28:20 selinux systemd[1]: Starting The nginx HTTP and reverse proxy server...
Sep 19 16:28:20 selinux nginx[7352]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
Sep 19 16:28:20 selinux nginx[7352]: nginx: [emerg] bind() to 0.0.0.0:4881 failed (13: Permission denied)
Sep 19 16:28:20 selinux nginx[7352]: nginx: configuration file /etc/nginx/nginx.conf test failed
Sep 19 16:28:20 selinux systemd[1]: nginx.service: Control process exited, code=exited, status=1/FAILURE
Sep 19 16:28:20 selinux systemd[1]: nginx.service: Failed with result 'exit-code'.
Sep 19 16:28:20 selinux systemd[1]: Failed to start The nginx HTTP and reverse proxy server.

[root@selinux ~]# systemctl status firewalld
Unit firewalld.service could not be found.

[root@selinux ~]# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

[root@selinux ~]# sestatus
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Memory protection checking:     actual (secure)
Max kernel policy version:      33

[root@selinux ~]# cat /var/log/audit/audit.log | grep denied
type=AVC msg=audit(1758299300.331:789): avc:  denied  { name_bind } for  pid=7352 comm="nginx" src=4881 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket permissive=0

[root@selinux ~]# cat /var/log/audit/audit.log | audit2why
type=AVC msg=audit(1758299300.331:789): avc:  denied  { name_bind } for  pid=7352 comm="nginx" src=4881 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket permissive=0

	Was caused by:
	The boolean nis_enabled was set incorrectly. 
	Description:
	Allow nis to enabled

	Allow access by executing:
	# setsebool -P nis_enabled 1

[root@selinux ~]# setsebool -P nis_enabled on
[root@selinux ~]# systemctl restart nginx
[root@selinux ~]# systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; preset: disabled)
     Active: active (running) since Fri 2025-09-19 16:50:51 UTC; 5s ago
    Process: 10039 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 10040 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 10041 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 10042 (nginx)
      Tasks: 3 (limit: 12026)
     Memory: 2.9M
        CPU: 50ms
     CGroup: /system.slice/nginx.service
             ├─10042 "nginx: master process /usr/sbin/nginx"
             ├─10043 "nginx: worker process"
             └─10044 "nginx: worker process"

Sep 19 16:50:51 selinux systemd[1]: Starting The nginx HTTP and reverse proxy server...
Sep 19 16:50:51 selinux nginx[10040]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
Sep 19 16:50:51 selinux nginx[10040]: nginx: configuration file /etc/nginx/nginx.conf test is successful
Sep 19 16:50:51 selinux systemd[1]: Started The nginx HTTP and reverse proxy server.


[root@selinux ~]# curl localhost:4881
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<title>Test Page for the HTTP Server on AlmaLinux</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<style type="text/css">
			/*<![CDATA[*/
			body {
				background-color: #fff;
				color: #000;
				font-size: 1.1em;
				font-family: "Red Hat Text", Helvetica, Tahoma, sans-serif;
				margin: 0;
				padding: 0;
                border-bottom: 30px solid #082336;
				min-height: 100vh;
				box-sizing: border-box;

[root@selinux ~]# getsebool -a | grep nis_enabled
nis_enabled --> on

